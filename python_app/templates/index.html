<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Signal Reconstruction Dashboard Pro</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;600;700&family=JetBrains+Mono:wght@400;700&display=swap');

        body {
            font-family: 'Outfit', sans-serif;
            background: #0f172a;
        }

        .glass-card {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
        }

        .status-pulse {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }

        .bg-gradient-mesh {
            background-color: #0f172a;
            background-image:
                radial-gradient(at 0% 0%, rgba(30, 58, 138, 0.3) 0, transparent 50%),
                radial-gradient(at 50% 0%, rgba(13, 148, 136, 0.2) 0, transparent 50%),
                radial-gradient(at 100% 0%, rgba(30, 58, 138, 0.3) 0, transparent 50%);
        }

        .mono-font {
            font-family: 'JetBrains Mono', monospace;
        }
    </style>
</head>

<body class="bg-gradient-mesh text-white min-h-screen p-6 md:p-10">
    <div class="max-w-7xl mx-auto">
        <!-- Header & Status -->
        <header class="flex flex-col md:flex-row justify-between items-start md:items-center mb-10 gap-4">
            <div>
                <h1 class="text-4xl font-bold tracking-tight text-white">
                    Acoustic <span
                        class="text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-cyan-400">Channel
                        Equalizer</span>
                </h1>
                <p class="text-slate-400 mt-1 font-light">AI-Based Acoustic Reconstruction using 1D-CNN</p>
            </div>

            <div class="flex items-center gap-4">
                <div id="status-container" class="glass-card px-4 py-2 flex items-center border-blue-500/30">
                    <span id="status-indicator"
                        class="status-pulse bg-red-500 shadow-[0_0_10px_rgba(239,68,68,0.5)]"></span>
                    <span id="status-text"
                        class="text-sm font-semibold uppercase tracking-widest text-slate-300">Disconnected</span>
                </div>
                <div id="mode-badge"
                    class="glass-card px-4 py-2 text-xs font-bold uppercase tracking-widest text-blue-400 border-blue-500/20">
                    Initializing...
                </div>
            </div>
        </header>

        <!-- Metrics Grid -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="glass-card p-6 border-l-4 border-blue-500">
                <h3 class="text-slate-400 text-xs font-bold uppercase mb-2">Original Amplitude</h3>
                <div class="flex items-baseline gap-2">
                    <span id="val-original" class="text-3xl font-bold mono-font text-blue-400">0.0000</span>
                </div>
            </div>
            <div class="glass-card p-6 border-l-4 border-red-500">
                <h3 class="text-slate-400 text-xs font-bold uppercase mb-2">Noisy Signal</h3>
                <div class="flex items-baseline gap-2">
                    <span id="val-noisy" class="text-3xl font-bold mono-font text-red-400">0.0000</span>
                </div>
            </div>
            <div class="glass-card p-6 border-l-4 border-emerald-500">
                <h3 class="text-slate-400 text-xs font-bold uppercase mb-2">Reconstructed</h3>
                <div class="flex items-baseline gap-2">
                    <span id="val-recon" class="text-3xl font-bold mono-font text-emerald-400">0.0000</span>
                </div>
            </div>
            <div class="glass-card p-6 border-l-4 border-amber-500">
                <h3 class="text-slate-400 text-xs font-bold uppercase mb-2">Accuracy (MSE)</h3>
                <div class="flex items-baseline gap-2">
                    <span id="val-mse" class="text-3xl font-bold mono-font text-amber-500">0.000</span>
                </div>
            </div>
        </div>

        <!-- Charts Grid -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Chart 1: Channel Environment -->
            <div class="glass-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-slate-200">Channel Environment</h2>
                    <span
                        class="text-[10px] bg-red-500/10 text-red-400 px-2 py-1 rounded-full border border-red-500/20 uppercase font-bold">Noisy
                        / Lost</span>
                </div>
                <div class="h-64">
                    <canvas id="channelChart"></canvas>
                </div>
            </div>

            <!-- Chart 2: Reconstruction -->
            <div class="glass-card p-6">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-lg font-semibold text-slate-200">Equalization Result</h2>
                    <span
                        class="text-[10px] bg-emerald-500/10 text-emerald-400 px-2 py-1 rounded-full border border-emerald-500/20 uppercase font-bold">Reconstructed</span>
                </div>
                <div class="h-64">
                    <canvas id="reconChart"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        const socket = io();
        const MAX_POINTS = 50;

        // Chart Configurations
        const chartOptions = {
            responsive: true,
            maintainAspectRatio: false,
            animation: false,
            scales: {
                y: { min: -1.5, max: 2.2, grid: { color: 'rgba(255,255,255,0.05)' }, ticks: { color: '#64748b' } },
                x: { grid: { display: false }, ticks: { display: false } }
            },
            plugins: { legend: { display: false } }
        };

        const channelCtx = document.getElementById('channelChart').getContext('2d');
        const reconCtx = document.getElementById('reconChart').getContext('2d');

        const channelChart = new Chart(channelCtx, {
            type: 'line',
            data: {
                labels: Array(MAX_POINTS).fill(''),
                datasets: [
                    { label: 'Original', data: Array(MAX_POINTS).fill(0), borderColor: '#60a5fa', borderWidth: 2, pointRadius: 0, tension: 0.3 },
                    { label: 'Noisy', data: Array(MAX_POINTS).fill(0), borderColor: '#f87171', borderWidth: 1.5, pointRadius: 2, pointBackgroundColor: '#ef4444', showLine: false }
                ]
            },
            options: chartOptions
        });

        const reconChart = new Chart(reconCtx, {
            type: 'line',
            data: {
                labels: Array(MAX_POINTS).fill(''),
                datasets: [
                    { label: 'Original', data: Array(MAX_POINTS).fill(0), borderColor: 'rgba(96, 165, 250, 0.3)', borderWidth: 1, borderDash: [5, 5], pointRadius: 0 },
                    { label: 'Reconstructed', data: Array(MAX_POINTS).fill(0), borderColor: '#34d399', borderWidth: 2.5, pointRadius: 0, tension: 0.3 }
                ]
            },
            options: chartOptions
        });

        socket.on('new_data', (data) => {
            // Update Status UI
            const indicator = document.getElementById('status-indicator');
            const statusText = document.getElementById('status-text');
            const modeBadge = document.getElementById('mode-badge');

            if (data.status.connected) {
                indicator.className = 'status-pulse bg-emerald-500 shadow-[0_0_10px_rgba(52,211,153,0.5)]';
                statusText.innerText = 'ESP32 Connected';
                modeBadge.innerText = 'HARDWARE MODE';
            } else {
                indicator.className = 'status-pulse bg-amber-500 shadow-[0_0_10px_rgba(245,158,11,0.5)]';
                statusText.innerText = 'MOCK MODE';
                modeBadge.innerText = 'SIMULATION';
            }

            // Update Metrics
            document.getElementById('val-original').innerText = data.clean.toFixed(4);
            document.getElementById('val-noisy').innerText = data.noisy !== null ? data.noisy.toFixed(4) : "LOST";
            document.getElementById('val-recon').innerText = data.reconstructed.toFixed(4);
            document.getElementById('val-mse').innerText = data.mse.toFixed(4);

            // Update Channel Chart
            channelChart.data.datasets[0].data.push(data.clean);
            channelChart.data.datasets[1].data.push(data.noisy);
            if (channelChart.data.datasets[0].data.length > MAX_POINTS) {
                channelChart.data.datasets[0].data.shift();
                channelChart.data.datasets[1].data.shift();
            }
            channelChart.update();

            // Update Recon Chart
            reconChart.data.datasets[0].data.push(data.clean);
            reconChart.data.datasets[1].data.push(data.reconstructed);
            if (reconChart.data.datasets[0].data.length > MAX_POINTS) {
                reconChart.data.datasets[0].data.shift();
                reconChart.data.datasets[1].data.shift();
            }
            reconChart.update();
        });
    </script>
</body>

</html>